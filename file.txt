this is pseudo code
some modification





added in branch1