this is pseudo code
some modification